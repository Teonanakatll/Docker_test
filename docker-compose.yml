version: '3'

services:
  # Придумываем название сврвиса
  django:
    # Будем вытягивать все настройки из Dockerfile, указываем путь к нему
    build: .
    # Название контейнера
    container_name: djangoc
    # При построении сервиса выполнить команду (запустить локальный сервер)
    # указываем любой порт
    command: python manage.py runserver 0.0.0.0:8000
    # Текущая директория проекта пробрасывается в директорию /usr/src/app контейнера
    volumes:
      - .:/usr/src/app
    # Прокидываем порты "локальный порт:порт контейнера
    ports:
      - "8000:8000"
    # Связываем сервис django с сервисом pgdb,
    # Сервис будет запущен, только после старта pgdb
    depends_on:
      - pgdb

  # Название для сервисо Postgresql
  pgdb:
    image: postgres  # Оброз
    environment:     # Переменные для подключению к базе данных
      - POSTGRES_DB=postgres         # Придумываем название для бд
      - POSTGRES_USER=postgres       # Логин
      - POSTGRES_PASSWORD=postgres   # Пароль
    container_name: pgdb
    # Пробрасываем папку с данными проекта (любую) со стандартной попкой на сервере
    volumes:
      - pgdbdata:/var/lib/postgresql/data/

# Создаём папку pgdbdata
volumes:
  pgdbdata: null